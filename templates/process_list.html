{% extends "base.html" %}

{% block body %}

<ol class="breadcrumb">
  <li>服务</li>
  <li class="active">服务管理</li>
</ol>

<div class="page-header">
    <h2>
        服务管理
    </h2>
</div>

<table class="table table-hover">
<caption>
<form class="form-inline" style="float: right;" action="/supervisor/process_list" method="post">
 {% csrf_token %}
  <div class="form-group">
    <p class="form-control-static">
        <select class="form-control" name="filter_select">
          <option {% if filter_select == "Status =" %} selected="selected" {% endif %}>状态 =</option>
          <option {% if filter_select == "Name" or filter_select == "" %} selected="selected" {% endif %}>名称</option>
          <option {% if filter_select == "Host" %} selected="selected" {% endif %}>主机</option>
        </select>
    </p>
    <input type="text" class="form-control" name="filter_keyword" value="{{filter_keyword}}" placeholder="">
  </div>
  <button type="submit" class="btn btn-default"><span class="fa fa-filter"></span> 过滤</button>
  <div class="btn-group">
  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    更多操作 <span class="caret"></span>
  </button>
  <ul class="dropdown-menu dropdown-menu-right">
    <li><a href="#">重启</a></li>
    <li><a href="#">启动</a></li>
    <li><a href="#">停止</a></li>
    <li role="separator" class="divider"></li>
    <li><a href="#">其他</a></li>
  </ul>
</div>
</form>
</caption>

    <tr>
        <td colspan="12" data-column="0">
            <span class="table_count">显示 {{ curent_page_size }} / {{ process_list.paginator.count }} 项目</span>
        </td>
    </tr>
    <tr class="active">
        <th><input type="checkbox" name="check_all" id="check_all" onclick="checkAll()"></th>
        <th width="10%">状态</th>
        <th width="30%">名称</thw>
        <th width="20%">主机</th>
        <th width="25%">详情</th>
        <th colspan="4" width="15%">操作</th>
    </tr>
    {% for process in process_list %}
    <tr>
        <td><input type="checkbox" name="check_item"></td>
        <td style="text-transform:capitalize;">
            {{process.statename|lower}}
        </td>
        <td>{{process.name}}</td>
        <td>{{process.host}}</td>
        <td>{{process.description|lower}}</td>
        <td>
 
          <!-- Split button -->
          <div class="btn-group">
            <a type="button" class="btn btn-default btn-sm" href="process_log?host={{process.host}}&host_port={{process.host_port}}&process_name={{process.name}}" target="_blank">查看日志</a>          
            <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class="caret"></span>
            </button>
            {% if request.session.role == "admin" %}
            <ul class="dropdown-menu dropdown-menu-right">
              <li><a href="javascript:;" onclick="process_opt('{{process.host}}','{{process.host_port}}','{{process.name}}','restart')">重启</a></li>
              <li role="separator" class="divider"></li>
              <li><a href="javascript:;" onclick="process_opt('{{process.host}}','{{process.host_port}}','{{process.name}}','start')">启动</a></li>
              <li><a href="javascript:;" onclick="process_opt('{{process.host}}','{{process.host_port}}','{{process.name}}','stop')">停止</a></li>
            </ul>
            {% endif %}
          </div>
        </td>

    </tr>
    {% endfor %}
    <tr>
        <td colspan="12" data-column="0">
            <span class="table_count">显示 {{ curent_page_size }} / {{ process_list.paginator.count }} 项目</span>
        </td>
    </tr>
</table>

<div>
  <span style="text-align:center; display:block;">
    <a>
        {% if process_list.has_previous %}
            <a style="text-decoration:underline; color:inherit;" href="{{ page_prefix }}{{ process_list.previous_page_number }}">Previous</a>
        {% endif %}
    </a>
    <a style="color:inherit;">&nbsp; < {{ process_list.number }} / {{ process_list.paginator.num_pages }} > &nbsp;</a>
    <a>
        {% if process_list.has_next %}
            <a style="text-decoration:underline; color:inherit;" href="{{ page_prefix }}{{ process_list.next_page_number }}">Next</a>
        {% endif %}
    </a>
  </span>
</div>

<script> 
//复选框的全选、取消全选功能
function checkAll() {
var all=document.getElementById('check_all');//获取到点击全选的那个复选框的id
var one=document.getElementsByName('check_item');//获取到复选框的名称
//因为获得的是数组，所以要循环 为每一个checked赋值
for(var i=0;i<one.length;i++){
one[i].checked=all.checked; //赋值
}
}
</script>

{% endblock %}
